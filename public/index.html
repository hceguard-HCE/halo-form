<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Registro Halo CE</title>
<style>
body { display:flex; justify-content:center; align-items:center; height:100vh; font-family:sans-serif; }
#formulario { display:flex; flex-direction:column; width:300px; }
#estadoDiv { display:none; margin-top:20px; }
button { margin-top:10px; }
</style>
</head>
<body>
<div id="formulario">
  <input id="nick" placeholder="Nick Halo CE" />
  <input id="pais" placeholder="País" />
  <input id="servidores" placeholder="¿En qué servidores juegas?" />
  <input id="prefJuego" placeholder="Preferencia (Pro / Casual)" />
  <textarea id="motivo" placeholder="Motivo para unirse"></textarea>
  <button id="crearBtn">Crear</button>
  <p>(12–48 horas para ser aprobado salvo recomendación)</p>
</div>

<div id="estadoDiv">
  Estado: <span id="estadoUsuario">Pendiente</span>
  <button id="btnConectar" disabled>Conectar</button>
</div>

<script>
const form = document.getElementById("formulario");
const estadoDiv = document.getElementById("estadoDiv");
const estadoUsuario = document.getElementById("estadoUsuario");
const btnConectar = document.getElementById("btnConectar");

function generarDeviceID(){ return 'xxxx-xxxx-xxxx'.replace(/[x]/g, ()=>Math.floor(Math.random()*10)); }

async function enviarRegistro(){
  const deviceID = localStorage.getItem("deviceID") || generarDeviceID();
  localStorage.setItem("deviceID", deviceID);

  const data = {
    nick: document.getElementById("nick").value,
    pais: document.getElementById("pais").value,
    servidores: document.getElementById("servidores").value,
    prefJuego: document.getElementById("prefJuego").value,
    motivo: document.getElementById("motivo").value,
    deviceID
  };
  localStorage.setItem("usuarioData", JSON.stringify(data));

  const WEBHOOK_URL = "TU_WEBHOOK_URL";
  await fetch(WEBHOOK_URL, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      content: `Nuevo registro:\nNick: ${data.nick}\nPaís: ${data.pais}\nServidores: ${data.servidores}\nPreferencia: ${data.prefJuego}\nMotivo: ${data.motivo}\nDeviceID: ${deviceID}`
    })
  });

  // Mostrar solo Estado Pendiente y botón Conectar deshabilitado
  form.style.display = "none";
  estadoDiv.style.display = "block";
  estadoUsuario.textContent = "Pendiente";
  btnConectar.disabled = true;
}

// Revisar si ya fue aprobado
async function checkEstado(){
  const data = JSON.parse(localStorage.getItem("usuarioData"));
  if(!data) return;

  form.style.display = "none";
  estadoDiv.style.display = "block";

  const res = await fetch(`https://TU_BOT_API/check/${data.deviceID}`);
  const json = await res.json();

  if(json.aprobado){
    estadoUsuario.textContent = "Activo";
    btnConectar.disabled = false;
  } else {
    estadoUsuario.textContent = "Pendiente";
    btnConectar.disabled = true;
  }
}

document.getElementById("crearBtn").onclick = enviarRegistro;

// Revisar cada 10 segundos si fue aprobado
setInterval(checkEstado, 10000);
checkEstado();
</script>
</body>
</html>
